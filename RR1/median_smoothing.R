#rm(list=ls())

# бібліотека для прогнозування
library(fpp2)
library(forecast)
library(png)
library(grid)
library(zoo)
library(pastecs)
library(ggplot2)
library(tidyr)

# зчитування файла з даними
pharma <- read.csv("C:/Users/Sophia/Documents/MO_Rozraha1/Rozrahunkova1/farm_sales_f.csv", header = TRUE)

#M01AB
M01AB_desk <- ts(pharma[,2], start = c(2016,1), frequency = 300)
M01AB_3 = rollmedian(M01AB_desk, k = 3)
M01AB_5 = rollmedian(M01AB_desk, k = 5)
M01AB_7 = rollmedian(M01AB_desk, k = 7)
M01AB_9 = rollmedian(M01AB_desk, k = 9)
M01AB_11 = rollmedian(M01AB_desk, k = 11)
M01AB_13 = rollmedian(M01AB_desk, k = 13)
M01AB_15 = rollmedian(M01AB_desk, k = 15)

pdf(file="C:/Users/Sophia/Documents/MO_Rozraha1/Rozrahunkova1/plots/Median/M01AB_mediansmoothing.pdf",
    width = 4,
    height = 4)
plot_M01AB3 <- plot(M01AB_desk, xlab = "Years, interval 3", ylab = "Sales volumes M01AB")
lines(M01AB_3, col="blue", lwd=3)
plot_M01AB5 <- plot(M01AB_desk, xlab = "Years, interval 5", ylab = "Sales volumes M01AB")
lines(M01AB_5, col="yellow", lwd=3)
plot_M01AB7 <- plot(M01AB_desk, xlab = "Years, interval 7", ylab = "Sales volumes M01AB")
lines(M01AB_7, col="green", lwd=3)
plot_M01AB9 <- plot(M01AB_desk, xlab = "Years, interval 9", ylab = "Sales volumes M01AB")
lines(M01AB_9, col="purple", lwd=3)
plot_M01AB11 <- plot(M01AB_desk, xlab = "Years, interval 11", ylab = "Sales volumes M01AB")
lines(M01AB_11, col="pink", lwd=3)
plot_M01AB13 <- plot(M01AB_desk, xlab = "Years, interval 13", ylab = "Sales volumes M01AB")
lines(M01AB_13, col="grey", lwd=3)
plot_M01AB15 <- plot(M01AB_desk, xlab = "Years, interval 15", ylab = "Sales volumes M01AB")
lines(M01AB_15, col="red", lwd=3)
abline(v=0)
text(x = 0, y = 1, labels="M01AB_median")
dev.off()

# підрахунок та виведення поворотних точок
M01AB_7 = runmed(df[ ,2], 7)
PT <- turnpoints(M01AB_7)
summary(PT)

#M01AE
M01AE_desk <- ts(pharma[,3], start = c(2016,1), frequency = 300)
M01AE_3 = rollmedian(M01AE_desk, k = 3)
M01AE_5 = rollmedian(M01AE_desk, k = 5)
M01AE_7 = rollmedian(M01AE_desk, k = 7)
M01AE_9 = rollmedian(M01AE_desk, k = 9)
M01AE_11 = rollmedian(M01AE_desk, k = 11)
M01AE_13 = rollmedian(M01AE_desk, k = 13)
M01AE_15 = rollmedian(M01AE_desk, k = 15)

pdf(file="C:/Users/Sophia/Documents/MO_Rozraha1/Rozrahunkova1/plots/Median/M01AE_mediansmoothing.pdf",
    width = 4,
    height = 4)
plot_M01AE3 <- plot(M01AE_desk, xlab = "Years, interval 3", ylab = "Sales volumes M01AE")
lines(M01AE_3, col="blue", lwd=3)
plot_M01AE5 <- plot(M01AE_desk, xlab = "Years, interval 5", ylab = "Sales volumes M01AE")
lines(M01AE_5, col="yellow", lwd=3)
plot_M01AE7 <- plot(M01AE_desk, xlab = "Years, interval 7", ylab = "Sales volumes M01AE")
lines(M01AE_7, col="green", lwd=3)
plot_M01AE9 <- plot(M01AE_desk, xlab = "Years, interval 9", ylab = "Sales volumes M01AE")
lines(M01AE_9, col="purple", lwd=3)
plot_M01AE11 <- plot(M01AE_desk, xlab = "Years, interval 11", ylab = "Sales volumes M01AE")
lines(M01AE_11, col="pink", lwd=3)
plot_M01AE13 <- plot(M01AE_desk, xlab = "Years, interval 13", ylab = "Sales volumes M01AE")
lines(M01AE_13, col="grey", lwd=3)
plot_M01AE15 <- plot(M01AE_desk, xlab = "Years, interval 15", ylab = "Sales volumes M01AE")
lines(M01AE_15, col="red", lwd=3)
abline(v=0)
text(x = 0, y = 1, labels="M01AE_median")
dev.off()

#N02BA
N02BA_desk <- ts(pharma[,4], start = c(2016,1), frequency = 300)
N02BA_3 = rollmedian(N02BA_desk, k = 3)
N02BA_5 = rollmedian(N02BA_desk, k = 5)
N02BA_7 = rollmedian(N02BA_desk, k = 7)
N02BA_9 = rollmedian(N02BA_desk, k = 9)
N02BA_11 = rollmedian(N02BA_desk, k = 11)
N02BA_13 = rollmedian(N02BA_desk, k = 13)
N02BA_15 = rollmedian(N02BA_desk, k = 15)

pdf(file="C:/Users/Sophia/Documents/MO_Rozraha1/Rozrahunkova1/plots/Median/N02BA_mediansmoothing.pdf",
    width = 4,
    height = 4)
plot_N02BA3 <- plot(N02BA_desk, xlab = "Years, interval 3", ylab = "Sales volumes N02BA")
lines(N02BA_3, col="blue", lwd=3)
plot_N02BA5 <- plot(N02BA_desk, xlab = "Years, interval 5", ylab = "Sales volumes N02BA")
lines(N02BA_5, col="yellow", lwd=3)
plot_N02BA7 <- plot(N02BA_desk, xlab = "Years, interval 7", ylab = "Sales volumes N02BA")
lines(N02BA_7, col="green", lwd=3)
plot_N02BA9 <- plot(N02BA_desk, xlab = "Years, interval 9", ylab = "Sales volumes N02BA")
lines(N02BA_9, col="purple", lwd=3)
plot_N02BA11 <- plot(N02BA_desk, xlab = "Years, interval 11", ylab = "Sales volumes N02BA")
lines(N02BA_11, col="pink", lwd=3)
plot_N02BA13 <- plot(N02BA_desk, xlab = "Years, interval 13", ylab = "Sales volumes N02BA")
lines(N02BA_13, col="grey", lwd=3)
plot_N02BA15 <- plot(N02BA_desk, xlab = "Years, interval 15", ylab = "Sales volumes N02BA")
lines(N02BA_15, col="red", lwd=3)
abline(v=0)
text(x = 0, y = 1, labels="N02BA_median")
dev.off()

#N02BE
N02BE_desk <- ts(pharma[,5], start = c(2016,1), frequency = 300)
N02BE_3 = rollmedian(N02BE_desk, k = 3)
N02BE_5 = rollmedian(N02BE_desk, k = 5)
N02BE_7 = rollmedian(N02BE_desk, k = 7)
N02BE_9 = rollmedian(N02BE_desk, k = 9)
N02BE_11 = rollmedian(N02BE_desk, k = 11)
N02BE_13 = rollmedian(N02BE_desk, k = 13)
N02BE_15 = rollmedian(N02BE_desk, k = 15)

pdf(file="C:/Users/Sophia/Documents/MO_Rozraha1/Rozrahunkova1/plots/Median/N02BE_mediansmoothing.pdf",
    width = 4,
    height = 4)
plot_N02BE3 <- plot(N02BE_desk, xlab = "Years, interval 3", ylab = "Sales volumes N02BE")
lines(N02BE_3, col="blue", lwd=3)
plot_N02BE5 <- plot(N02BE_desk, xlab = "Years, interval 5", ylab = "Sales volumes N02BE")
lines(N02BE_5, col="yellow", lwd=3)
plot_N02BE7 <- plot(N02BE_desk, xlab = "Years, interval 7", ylab = "Sales volumes N02BE")
lines(N02BE_7, col="green", lwd=3)
plot_N02BE9 <- plot(N02BE_desk, xlab = "Years, interval 9", ylab = "Sales volumes N02BE")
lines(N02BE_9, col="purple", lwd=3)
plot_N02BE11 <- plot(N02BE_desk, xlab = "Years, interval 11", ylab = "Sales volumes N02BE")
lines(N02BE_11, col="pink", lwd=3)
plot_N02BE13 <- plot(N02BE_desk, xlab = "Years, interval 13", ylab = "Sales volumes N02BE")
lines(N02BE_13, col="grey", lwd=3)
plot_N02BE15 <- plot(N02BE_desk, xlab = "Years, interval 15", ylab = "Sales volumes N02BE")
lines(N02BE_15, col="red", lwd=3)
abline(v=0)
text(x = 0, y = 1, labels="N02BE_median")
dev.off()

#N05B
N05B_desk <- ts(pharma[,6], start = c(2016,1), frequency = 300)
N05B_3 = rollmedian(N05B_desk, k = 3)
N05B_5 = rollmedian(N05B_desk, k = 5)
N05B_7 = rollmedian(N05B_desk, k = 7)
N05B_9 = rollmedian(N05B_desk, k = 9)
N05B_11 = rollmedian(N05B_desk, k = 11)
N05B_13 = rollmedian(N05B_desk, k = 13)
N05B_15 = rollmedian(N05B_desk, k = 15)

pdf(file="C:/Users/Sophia/Documents/MO_Rozraha1/Rozrahunkova1/plots/Median/N05B_mediansmoothing.pdf",
    width = 4,
    height = 4)
plot_N05B3 <- plot(N05B_desk, xlab = "Years, interval 3", ylab = "Sales volumes N05B")
lines(N05B_3, col="blue", lwd=3)
plot_N05B5 <- plot(N05B_desk, xlab = "Years, interval 5", ylab = "Sales volumes N05B")
lines(N05B_5, col="yellow", lwd=3)
plot_N05B7 <- plot(N05B_desk, xlab = "Years, interval 7", ylab = "Sales volumes N05B")
lines(N05B_7, col="green", lwd=3)
plot_N05B9 <- plot(N05B_desk, xlab = "Years, interval 9", ylab = "Sales volumes N05B")
lines(N05B_9, col="purple", lwd=3)
plot_N05B11 <- plot(N05B_desk, xlab = "Years, interval 11", ylab = "Sales volumes N05B")
lines(N05B_11, col="pink", lwd=3)
plot_N05B13 <- plot(N05B_desk, xlab = "Years, interval 13", ylab = "Sales volumes N05B")
lines(N05B_13, col="grey", lwd=3)
plot_N05B15 <- plot(N05B_desk, xlab = "Years, interval 15", ylab = "Sales volumes N05B")
lines(N05B_15, col="red", lwd=3)
abline(v=0)
text(x = 0, y = 1, labels="N05B_median")
dev.off()

#N05C
N05C_desk <- ts(pharma[,7], start = c(2016,1), frequency = 300)
N05C_3 = rollmedian(N05C_desk, k = 3)
N05C_5 = rollmedian(N05C_desk, k = 5)
N05C_7 = rollmedian(N05C_desk, k = 7)
N05C_9 = rollmedian(N05C_desk, k = 9)
N05C_11 = rollmedian(N05C_desk, k = 11)
N05C_13 = rollmedian(N05C_desk, k = 13)
N05C_15 = rollmedian(N05C_desk, k = 15)

pdf(file="C:/Users/Sophia/Documents/MO_Rozraha1/Rozrahunkova1/plots/Median/N05C_mediansmoothing.pdf",
    width = 4,
    height = 4)
plot_N05C3 <- plot(N05C_desk, xlab = "Years, interval 3", ylab = "Sales volumes N05C")
lines(N05C_3, col="blue", lwd=3)
plot_N05C5 <- plot(N05C_desk, xlab = "Years, interval 5", ylab = "Sales volumes N05C")
lines(N05C_5, col="yellow", lwd=3)
plot_N05C7 <- plot(N05C_desk, xlab = "Years, interval 7", ylab = "Sales volumes N05C")
lines(N05C_7, col="green", lwd=3)
plot_N05C9 <- plot(N05C_desk, xlab = "Years, interval 9", ylab = "Sales volumes N05C")
lines(N05C_9, col="purple", lwd=3)
plot_N05C11 <- plot(N05C_desk, xlab = "Years, interval 11", ylab = "Sales volumes N05C")
lines(N05C_11, col="pink", lwd=3)
plot_N05C13 <- plot(N05C_desk, xlab = "Years, interval 13", ylab = "Sales volumes N05C")
lines(N05C_13, col="grey", lwd=3)
plot_N05C15 <- plot(N05C_desk, xlab = "Years, interval 15", ylab = "Sales volumes N05C")
lines(N05C_15, col="red", lwd=3)
abline(v=0)
text(x = 0, y = 1, labels="N05C_median")
dev.off()

#R03
R03_desk <- ts(pharma[,7], start = c(2016,1), frequency = 300)
R03_3 = rollmedian(R03_desk, k = 3)
R03_5 = rollmedian(R03_desk, k = 5)
R03_7 = rollmedian(R03_desk, k = 7)
R03_9 = rollmedian(R03_desk, k = 9)
R03_11 = rollmedian(R03_desk, k = 11)
R03_13 = rollmedian(R03_desk, k = 13)
R03_15 = rollmedian(R03_desk, k = 15)

pdf(file="C:/Users/Sophia/Documents/MO_Rozraha1/Rozrahunkova1/plots/Median/R03_mediansmoothing.pdf",
    width = 4,
    height = 4)
plot_R033 <- plot(R03_desk, xlab = "Years, interval 3", ylab = "Sales volumes R03")
lines(R03_3, col="blue", lwd=3)
plot_R035 <- plot(R03_desk, xlab = "Years, interval 5", ylab = "Sales volumes R03")
lines(R03_5, col="yellow", lwd=3)
plot_R037 <- plot(R03_desk, xlab = "Years, interval 7", ylab = "Sales volumes R03")
lines(R03_7, col="green", lwd=3)
plot_R039 <- plot(R03_desk, xlab = "Years, interval 9", ylab = "Sales volumes R03")
lines(R03_9, col="purple", lwd=3)
plot_R0311 <- plot(R03_desk, xlab = "Years, interval 11", ylab = "Sales volumes R03")
lines(R03_11, col="pink", lwd=3)
plot_R0313 <- plot(R03_desk, xlab = "Years, interval 13", ylab = "Sales volumes R03")
lines(R03_13, col="grey", lwd=3)
plot_R0315 <- plot(R03_desk, xlab = "Years, interval 15", ylab = "Sales volumes R03")
lines(R03_15, col="red", lwd=3)
abline(v=0)
text(x = 0, y = 1, labels="R03_median")
dev.off()

#R06
R06_desk <- ts(pharma[,7], start = c(2016,1), frequency = 300)
R06_3 = rollmedian(R06_desk, k = 3)
R06_5 = rollmedian(R06_desk, k = 5)
R06_7 = rollmedian(R06_desk, k = 7)
R06_9 = rollmedian(R06_desk, k = 9)
R06_11 = rollmedian(R06_desk, k = 11)
R06_13 = rollmedian(R06_desk, k = 13)
R06_15 = rollmedian(R06_desk, k = 15)

pdf(file="C:/Users/Sophia/Documents/MO_Rozraha1/Rozrahunkova1/plots/Median/R06_mediansmoothing.pdf",
    width = 4,
    height = 4)
plot_R063 <- plot(R06_desk, xlab = "Years, interval 3", ylab = "Sales volumes R06")
lines(R06_3, col="blue", lwd=3)
plot_R065 <- plot(R06_desk, xlab = "Years, interval 5", ylab = "Sales volumes R06")
lines(R06_5, col="yellow", lwd=3)
plot_R067 <- plot(R06_desk, xlab = "Years, interval 7", ylab = "Sales volumes R06")
lines(R06_7, col="green", lwd=3)
plot_R069 <- plot(R06_desk, xlab = "Years, interval 9", ylab = "Sales volumes R06")
lines(R06_9, col="purple", lwd=3)
plot_R0611 <- plot(R06_desk, xlab = "Years, interval 11", ylab = "Sales volumes R06")
lines(R06_11, col="pink", lwd=3)
plot_R0613 <- plot(R06_desk, xlab = "Years, interval 13", ylab = "Sales volumes R06")
lines(R06_13, col="grey", lwd=3)
plot_R0615 <- plot(R06_desk, xlab = "Years, interval 15", ylab = "Sales volumes R06")
lines(R06_15, col="red", lwd=3)
abline(v=0)
text(x = 0, y = 1, labels="R06_median")
dev.off()
