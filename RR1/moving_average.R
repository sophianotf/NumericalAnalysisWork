#rm(list=ls())

# бібліотека для прогнозування
library(fpp2)
library(forecast)
library(png)
library(grid)
#поворотні точки - бібліотека
library(pastecs)

# зчитування файла з даними
pharma <- read.csv("C:/Users/Sophia/Documents/MO_Rozraha1/Rozrahunkova1/farm_sales_f.csv", header = TRUE)
head(pharma)

#M01AB
#M01AB_desk <- ts(pharma[,2], start = c(2016,1), frequency = 1)
M01AB_desk <- ts(pharma[,2], start = c(2016,1), frequency = 300)
M01AB_3 = forecast::ma(M01AB_desk, order = 3)
M01AB_5 = forecast::ma(M01AB_desk, order = 5)
M01AB_7 = forecast::ma(M01AB_desk, order = 7)
M01AB_9 = forecast::ma(M01AB_desk, order = 9)
M01AB_11 = forecast::ma(M01AB_desk, order = 11)
M01AB_13 = forecast::ma(M01AB_desk, order = 13)
M01AB_15 = forecast::ma(M01AB_desk, order = 15)

pdf(file="C:/Users/Sophia/Documents/MO_Rozraha1/Rozrahunkova1/plots/Mov_Av/M01AB_movingaverage.pdf",
    width = 4,
    height = 4)
plot_M01AB3 <- plot(M01AB_desk, xlab = "interval 3", ylab = "Sales volumes M01AB", type = "l")
lines(M01AB_3, col="blue", lwd=3)
plot_M01AB5 <- plot(M01AB_desk, xlab = "interval 5", ylab = "Sales volumes M01AB", type = "l")
lines(M01AB_5, col="yellow", lwd=3)
plot_M01AB7 <- plot(M01AB_desk, xlab = "interval 7", ylab = "Sales volumes M01AB", type = "l")
lines(M01AB_7, col="green", lwd=3)
plot_M01AB9 <- plot(M01AB_desk, xlab = "interval 9", ylab = "Sales volumes M01AB", type = "l")
lines(M01AB_9, col="purple", lwd=3)
plot_M01AB11 <- plot(M01AB_desk, xlab = "interval 11", ylab = "Sales volumes M01AB", type = "l")
lines(M01AB_11, col="pink", lwd=3)
plot_M01AB13 <- plot(M01AB_desk, xlab = "interval 13", ylab = "Sales volumes M01AB", type = "l")
lines(M01AB_13, col="grey", lwd=3)
plot_M01AB15 <- plot(M01AB_desk, xlab = "interval 15", ylab = "Sales volumes M01AB", type = "l")
lines(M01AB_15, col="red", lwd=3)
abline(v=0)
text(x = 0, y = 1, labels="M01AB_ma")
dev.off()

#M01AE
M01AE_desk <- ts(pharma[,3], start = c(2018,1), frequency = 300)
M01AE_3 = forecast::ma(M01AE_desk, order = 3)
M01AE_5 = forecast::ma(M01AE_desk, order = 5)
M01AE_7 = forecast::ma(M01AE_desk, order = 7)
M01AE_9 = forecast::ma(M01AE_desk, order = 9)
M01AE_11 = forecast::ma(M01AE_desk, order = 11)
M01AE_13 = forecast::ma(M01AE_desk, order = 13)
M01AE_15 = forecast::ma(M01AE_desk, order = 15)
pdf(file="C:/Users/Sophia/Documents/MO_Rozraha1/Rozrahunkova1/plots/Mov_Av/M01AE_movingaverage.pdf",
    width = 4,
    height = 4)
plot_M01AE3 <- plot(M01AE_desk, xlab = "interval 3", ylab = "Sales volumes M01AE")
lines(M01AE_3, col="blue", lwd=3)
plot_M01AE5 <- plot(M01AE_desk, xlab = "interval 5", ylab = "Sales volumes M01AE")
lines(M01AE_5, col="yellow", lwd=3)
plot_M01AE7 <- plot(M01AE_desk, xlab = "interval 7", ylab = "Sales volumes M01AE")
lines(M01AE_7, col="green", lwd=3)
plot_M01AE9 <- plot(M01AE_desk, xlab = "interval 9", ylab = "Sales volumes M01AE")
lines(M01AE_9, col="purple", lwd=3)
plot_M01AE11 <- plot(M01AE_desk, xlab = "interval 11", ylab = "Sales volumes M01AE")
lines(M01AE_11, col="pink", lwd=3)
plot_M01AE13 <- plot(M01AE_desk, xlab = "interval 13", ylab = "Sales volumes M01AE")
lines(M01AE_13, col="grey", lwd=3)
plot_M01AE15 <- plot(M01AE_desk, xlab = "interval 15", ylab = "Sales volumes M01AE")
lines(M01AE_15, col="red", lwd=3)
abline(v=0)
text(x = 0, y = 1, labels="M01AE_ma")
dev.off()

#N01BA
N02BA_desk <- ts(pharma[,4], start = c(2014,1), frequency = 300)
N02BA_3 = forecast::ma(N02BA_desk, order = 3, centre = TRUE)
N02BA_5 = forecast::ma(N02BA_desk, order = 5, centre = TRUE)
N02BA_7 = forecast::ma(N02BA_desk, order = 7, centre = TRUE)
N02BA_9 = forecast::ma(N02BA_desk, order = 9, centre = TRUE)
N02BA_11 = forecast::ma(N02BA_desk, order = 11, centre = TRUE)
N02BA_13 = forecast::ma(N02BA_desk, order = 13, centre = TRUE)
N02BA_15 = forecast::ma(N02BA_desk, order = 15, centre = TRUE)
pdf(file="C:/Users/Sophia/Documents/MO_Rozraha1/Rozrahunkova1/plots/Mov_Av/N02BA_movingaverage.pdf",
    width = 4,
    height = 4)
plot_N02BA3 <- plot(N02BA_desk, xlab = "interval 3", ylab = "Sales volumes N02BA")
lines(N02BA_3, col="blue", lwd=3)
plot_N02BA5 <- plot(N02BA_desk, xlab = "interval 5", ylab = "Sales volumes N02BA")
lines(N02BA_5, col="yellow", lwd=3)
plot_N02BA7 <- plot(N02BA_desk, xlab = "interval 7", ylab = "Sales volumes N02BA")
lines(N02BA_7, col="green", lwd=3)
plot_N02BA9 <- plot(N02BA_desk, xlab = "interval 9", ylab = "Sales volumes N02BA")
lines(N02BA_9, col="purple", lwd=3)
plot_N02BA11 <- plot(N02BA_desk, xlab = "interval 11", ylab = "Sales volumes N02BA")
lines(N02BA_11, col="pink", lwd=3)
plot_N02BA13 <- plot(N02BA_desk, xlab = "interval 13", ylab = "Sales volumes N02BA")
lines(N02BA_13, col="grey", lwd=3)
plot_N02BA15 <- plot(N02BA_desk, xlab = "interval 15", ylab = "Sales volumes N02BA")
lines(N02BA_15, col="red", lwd=3)
abline(v=0)
text(x = 0, y = 1, labels="N02BA_ma")
dev.off()

#N01BE
N02BE_desk <- ts(pharma[,5], start = c(2014,1), frequency = 300)
N02BE_3 = forecast::ma(N02BA_desk, order = 3, centre = TRUE)
N02BE_5 = forecast::ma(N02BA_desk, order = 5, centre = TRUE)
N02BE_7 = forecast::ma(N02BA_desk, order = 7, centre = TRUE)
N02BE_9 = forecast::ma(N02BA_desk, order = 9, centre = TRUE)
N02BE_11 = forecast::ma(N02BA_desk, order = 11, centre = TRUE)
N02BE_13 = forecast::ma(N02BA_desk, order = 13, centre = TRUE)
N02BE_15 = forecast::ma(N02BA_desk, order = 15, centre = TRUE)
pdf(file="C:/Users/Sophia/Documents/MO_Rozraha1/Rozrahunkova1/plots/Mov_Av/N02BE_movingaverage.pdf",
    width = 4,
    height = 4)
plot_N02BE3 <- plot(N02BE_desk, xlab = "interval 3", ylab = "Sales volumes N02BE")
lines(N02BE_3, col="blue", lwd=3)
plot_N02BE5 <- plot(N02BE_desk, xlab = "interval 5", ylab = "Sales volumes N02BE")
lines(N02BE_5, col="yellow", lwd=3)
plot_N02BE7 <- plot(N02BE_desk, xlab = "interval 7", ylab = "Sales volumes N02BE")
lines(N02BE_7, col="green", lwd=3)
plot_N02BE9 <- plot(N02BE_desk, xlab = "interval 9", ylab = "Sales volumes N02BE")
lines(N02BE_9, col="purple", lwd=3)
plot_N02BE11 <- plot(N02BE_desk, xlab = "interval 11", ylab = "Sales volumes N02BE")
lines(N02BE_11, col="pink", lwd=3)
plot_N02BE13 <- plot(N02BE_desk, xlab = "interval 13", ylab = "Sales volumes N02BE")
lines(N02BE_13, col="grey", lwd=3)
plot_N02BE15 <- plot(N02BE_desk, xlab = "interval 15", ylab = "Sales volumes N02BE")
lines(N02BE_15, col="red", lwd=3)
abline(v=0)
text(x = 0, y = 1, labels="N02BE_ma")
dev.off()

#N05B
N05B_desk <- ts(pharma[,6], start = c(2014,1), frequency = 300)
N05B_3 = forecast::ma(N05B_desk, order = 3, centre = TRUE)
N05B_5 = forecast::ma(N05B_desk, order = 5, centre = TRUE)
N05B_7 = forecast::ma(N05B_desk, order = 7, centre = TRUE)
N05B_9 = forecast::ma(N05B_desk, order = 9, centre = TRUE)
N05B_11 = forecast::ma(N05B_desk, order = 11, centre = TRUE)
N05B_13 = forecast::ma(N05B_desk, order = 13, centre = TRUE)
N05B_15 = forecast::ma(N05B_desk, order = 15, centre = TRUE)
pdf(file="C:/Users/Sophia/Documents/MO_Rozraha1/Rozrahunkova1/plots/Mov_Av/N05B_movingaverage.pdf",
    width = 4,
    height = 4)
plot_N05B3 <- plot(N05B_desk, xlab = "interval 3", ylab = "Sales volumes N05B")
lines(N05B_3, col="blue", lwd=3)
plot_N05B5 <- plot(N05B_desk, xlab = "interval 5", ylab = "Sales volumes N05B")
lines(N05B_5, col="yellow", lwd=3)
plot_N05B7 <- plot(N05B_desk, xlab = "interval 7", ylab = "Sales volumes N05B")
lines(N05B_7, col="green", lwd=3)
plot_N05B9 <- plot(N05B_desk, xlab = "interval 9", ylab = "Sales volumes N05B")
lines(N05B_9, col="purple", lwd=3)
plot_N05B11 <- plot(N05B_desk, xlab = "interval 11", ylab = "Sales volumes N05B")
lines(N05B_11, col="pink", lwd=3)
plot_N05B13 <- plot(N05B_desk, xlab = "interval 13", ylab = "Sales volumes N05B")
lines(N05B_13, col="grey", lwd=3)
plot_N05B15 <- plot(N05B_desk, xlab = "interval 15", ylab = "Sales volumes N05B")
lines(N05B_15, col="red", lwd=3)
abline(v=0)
text(x = 0, y = 1, labels="N05B_ma")
dev.off()

#N05C
N05C_desk <- ts(pharma[,7], start = c(2014,1), frequency = 300)
N05C_3 = forecast::ma(N05C_desk, order = 3, centre = TRUE)
N05C_5 = forecast::ma(N05C_desk, order = 5, centre = TRUE)
N05C_7 = forecast::ma(N05C_desk, order = 7, centre = TRUE)
N05C_9 = forecast::ma(N05C_desk, order = 9, centre = TRUE)
N05C_11 = forecast::ma(N05C_desk, order = 11, centre = TRUE)
N05C_13 = forecast::ma(N05C_desk, order = 13, centre = TRUE)
N05C_15 = forecast::ma(N05C_desk, order = 15, centre = TRUE)
pdf(file="C:/Users/Sophia/Documents/MO_Rozraha1/Rozrahunkova1/plots/Mov_Av/N05C_movingaverage.pdf",
    width = 4,
    height = 4)
plot_N05C3 <- plot(N05C_desk, xlab = "interval 3", ylab = "Sales volumes N05C")
lines(N05C_3, col="blue", lwd=3)
plot_N05C5 <- plot(N05C_desk, xlab = "interval 5", ylab = "Sales volumes N05C")
lines(N05C_5, col="yellow", lwd=3)
plot_N05C7 <- plot(N05C_desk, xlab = "interval 7", ylab = "Sales volumes N05C")
lines(N05C_7, col="green", lwd=3)
plot_N05C9 <- plot(N05C_desk, xlab = "interval 9", ylab = "Sales volumes N05C")
lines(N05C_9, col="purple", lwd=3)
plot_N05C11 <- plot(N05C_desk, xlab = "interval 11", ylab = "Sales volumes N05C")
lines(N05C_11, col="pink", lwd=3)
plot_N05C13 <- plot(N05C_desk, xlab = "interval 13", ylab = "Sales volumes N05C")
lines(N05C_13, col="grey", lwd=3)
plot_N05C15 <- plot(N05C_desk, xlab = "Years, interval 15", ylab = "Sales volumes N05C")
lines(N05C_15, col="red", lwd=3)
abline(v=0)
text(x = 0, y = 1, labels="N05C_ma")
dev.off()

#R03
R03_desk <- ts(pharma[,8], start = c(2014,1), frequency = 300)
R03_3 = forecast::ma(R03_desk, order = 3, centre = TRUE)
R03_5 = forecast::ma(R03_desk, order = 5, centre = TRUE)
R03_7 = forecast::ma(R03_desk, order = 7, centre = TRUE)
R03_9 = forecast::ma(R03_desk, order = 9, centre = TRUE)
R03_11 = forecast::ma(R03_desk, order = 11, centre = TRUE)
R03_13 = forecast::ma(R03_desk, order = 13, centre = TRUE)
R03_15 = forecast::ma(R03_desk, order = 15, centre = TRUE)
pdf(file="C:/Users/Sophia/Documents/MO_Rozraha1/Rozrahunkova1/plots/Mov_Av/R03_movingaverage.pdf",
    width = 4,
    height = 4)
plot_R033 <- plot(R03_desk, xlab = "interval 3", ylab = "Sales volumes R03")
lines(R03_3, col="blue", lwd=3)
plot_R035 <- plot(R03_desk, xlab = "interval 5", ylab = "Sales volumes R03")
lines(R03_5, col="yellow", lwd=3)
plot_R037 <- plot(R03_desk, xlab = "interval 7", ylab = "Sales volumes R03")
lines(R03_7, col="green", lwd=3)
plot_R039 <- plot(R03_desk, xlab = "interval 9", ylab = "Sales volumes R03")
lines(R03_9, col="purple", lwd=3)
plot_R0311 <- plot(R03_desk, xlab = "interval 11", ylab = "Sales volumes R03")
lines(R03_11, col="pink", lwd=3)
plot_R0313 <- plot(R03_desk, xlab = "interval 13", ylab = "Sales volumes R03")
lines(R03_13, col="grey", lwd=3)
plot_R0315 <- plot(R03_desk, xlab = "interval 15", ylab = "Sales volumes R03")
lines(R03_15, col="red", lwd=3)
abline(v=0)
text(x = 0, y = 1, labels="R03_ma")
dev.off()

#R06
R06_desk <- ts(pharma[,9], start = c(2014,1), frequency = 300)
R06_3 = forecast::ma(R06_desk, order = 3, centre = TRUE)
R06_5 = forecast::ma(R06_desk, order = 5, centre = TRUE)
R06_7 = forecast::ma(R06_desk, order = 7, centre = TRUE)
R06_9 = forecast::ma(R06_desk, order = 9, centre = TRUE)
R06_11 = forecast::ma(R06_desk, order = 11, centre = TRUE)
R06_13 = forecast::ma(R06_desk, order = 13, centre = TRUE)
R06_15 = forecast::ma(R06_desk, order = 15, centre = TRUE)
pdf(file="C:/Users/Sophia/Documents/MO_Rozraha1/Rozrahunkova1/plots/Mov_Av/R06_movingaverage.pdf",
    width = 4,
    height = 4)
plot_R063 <- plot(R06_desk, xlab = "interval 3", ylab = "Sales volumes R06")
lines(R06_3, col="blue", lwd=3)
plot_R065 <- plot(R06_desk, xlab = "interval 5", ylab = "Sales volumes R06")
lines(R06_5, col="yellow", lwd=3)
plot_R067 <- plot(R06_desk, xlab = "interval 7", ylab = "Sales volumes R06")
lines(R06_7, col="green", lwd=3)
plot_R069 <- plot(R06_desk, xlab = "interval 9", ylab = "Sales volumes R06")
lines(R06_9, col="purple", lwd=3)
plot_R0611 <- plot(R06_desk, xlab = "interval 11", ylab = "Sales volumes R06")
lines(R06_11, col="pink", lwd=3)
plot_R0613 <- plot(R06_desk, xlab = "interval 13", ylab = "Sales volumes R06")
lines(R06_13, col="grey", lwd=3)
plot_R0615 <- plot(R06_desk, xlab = "Years, interval 15", ylab = "Sales volumes R06")
lines(R06_15, col="red", lwd=3)
abline(v=0)
text(x = 0, y = 1, labels="R06_ma")
dev.off()

###################################

M01AB_7 = runmed(df[ ,2], 7)
PT <- turnpoints(M01AB_7)
summary(PT)
